<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Matching Service Test Client</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    label, input, select, button { margin: 0.5em 0; }
    #log { border: 1px solid #ccc; padding: 1em; height: 200px; overflow-y: auto; background: #f9f9f9; }
  </style>
</head>
<body>
  <h2>Matching Service Test Client</h2>
  <div>
    <label for="difficulty">Difficulty:</label>
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
    <br>
    <label for="topics">Topics (comma separated):</label>
    <input type="text" id="topics" placeholder="e.g. array,dp" />
    <br>
    <label for="userId">User ID:</label>
    <input type="text" id="userId" placeholder="user123" />
    <br>
    <button id="connectBtn">Connect</button>
    <button id="joinBtn" disabled>Join Match</button>
    <button id="cancelBtn" disabled>Cancel Match</button>
  </div>
  <h3>Log</h3>
  <div id="log"></div>

  <script>
    let socket;
    const log = (msg) => {
      const logDiv = document.getElementById('log');
      logDiv.innerHTML += `<div>${msg}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    };

    document.getElementById('connectBtn').onclick = () => {
      const userId = document.getElementById('userId').value.trim();
      if (!userId) return log('Please enter a User ID.');
      socket = io('/matching', {
        transports: ['websocket'],
        auth: { token: userId } // Simulate JWT with userId for testing
      });
      log('Connecting...');
      socket.on('connect', () => {
        log('Connected! Socket ID: ' + socket.id);
        document.getElementById('joinBtn').disabled = false;
        document.getElementById('cancelBtn').disabled = false;
      });
      socket.on('disconnect', () => {
        log('Disconnected.');
        document.getElementById('joinBtn').disabled = true;
        document.getElementById('cancelBtn').disabled = true;
      });
      socket.on('match:queued', (data) => {
        log('Queued! Estimated wait: ' + data.estWaitMs + 'ms');
      });
      socket.on('match:found', (data) => {
        log('Match found! Room/session ID: ' + data.sessionId);
        log('Question ID: ' + data.questionId);
        log('Session Token: ' + data.sessionToken);
      });
      socket.on('match:timeout', () => {
        log('Match timeout.');
      });
      socket.on('match:error', (err) => {
        log('Error: ' + err.message);
      });
    };

    document.getElementById('joinBtn').onclick = () => {
      const difficulty = document.getElementById('difficulty').value;
      const topics = document.getElementById('topics').value.split(',').map(t => t.trim()).filter(Boolean);
      socket.emit('match:join', { difficulty, topics });
      log('Sent match:join');
    };

    document.getElementById('cancelBtn').onclick = () => {
      socket.emit('match:cancel');
      log('Sent match:cancel');
    };
  </script>
</body>
</html>
